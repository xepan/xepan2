echo "======== XEPAN IS ASKING ============"
echo What is mysql password you want to set
read mysqlpassword

echo "======== XEPAN IS ASKING ============"
echo Input xepan installation database name
read xepan_db_name

echo "======== XEPAN IS ASKING ============"
echo Which Epan version you want to install like 0.92
read xepan_version

echo "======== XEPAN IS ASKING ============"
echo Epan Host or IP for crontab
read xepan_host

apt-get upgrade
apt-get update
sudo dpkg-reconfigure tzdata
sudo apt-get install software-properties-common
sudo apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xF1656F24C74CD1D8
sudo apt-get update && sudo apt-get install -y mariadb-server mariadb-client
service mysql start
#mysql_secure_installation
sed -i 's/bind-address/#bind-address/g' /etc/mysql/mariadb.conf.d/50-server.cnf

mysql -uroot -p$mysqlpassword -e "GRANT ALL ON *.* to root@'%' IDENTIFIED BY '$mysqlpassword';GRANT ALL ON *.* to root@'localhost' IDENTIFIED BY '$mysqlpassword';"
service mysql restart
mysql -uroot -p$mysqlpassword -e "create database $xepan_db_name;"

apt-get install -y apache2

sudo apt-get install -y php7.1 libapache2-mod-php7.1 php7.1-cli php7.1-common php7.1-mbstring php7.1-gd php7.1-intl php7.1-xml php7.1-mysql php7.1-mcrypt php7.1-zip php7.1-curl php7.1-imap
apt-get install -y unzip 
cd /var/www/html


wget http://epan.in/xepan2-$xepan_version.zip

unzip xepan2-$xepan_version.zip
rm index.html

chown -R www-data:www-data .

# php settings
sed -i 's/display_errors = Off/display_errors = On/g' /etc/php/7.1/apache2/php.ini
sed -i 's/post_max_size = 2M/post_max_size = 20M/g' /etc/php/7.1/apache2/php.ini
sed -i 's/upload_max_filesize = 2M/upload_max_filesize = 20M/g' /etc/php/7.1/apache2/php.ini

service apache2 restart

# wsserver run
cd wsserver
nohup php index.php >/dev/null 2>&1 &

# setup cronjob
cat <(crontab -l) <(echo "* * * * * wget -O /dev/null -o /dev/null \"http://$xepan_host/?page=xepan_base_cron&cut_page=1\"") | crontab -

cd ..

echo "======== DONE ============"

#echo "run http://{serverip}/install and follow setup"



